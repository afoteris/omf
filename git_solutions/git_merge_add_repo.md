# Как сделать другой репозиторий ответвлением в текущем?

## 1

```
git remote add letters путь/к/другому/репозиторию
git fetch letters
git checkout -b base letters/master # Ветки ж master в обеих?
git log master
git rebase --root --onto abcdef
```

Перевесить цепочку коммитов (rebase)...
...от текущего до основания (--root)...
...на коммит с хэшем abcdef (--onto abcdef).

## 2

```
git checkout -b <имя новой ветки> <хеш комита №2>
git fetch <URL репозитория №2> <имя ветки в репозитории №2>
git merge --allow-unrelated-histories FETCH_HEAD
```

Перед выполнением необходимо убедиться, что вы находитесь в нужной ветке репозитория №1.
В третьей строке специальная опция, чтобы избежать ошибки: fatal: refusing to merge unrelated histories, о которой подробнее описано тут.
При наличии конфликтов на третьем этапе их надо разрешить самому так, как вы считаете нужным.
Результатом будет ветка <имя новой ветки> в репозитории №1.

## 3

Можно воспользоваться командой format-patch и парной для неё `am`.

В каталоге 0 у нас хранилище с такой историей:
```
$ git log --one-line
a3d5387 5
2b7f19f 4
e1d8018 3
3e1fa25 2
7e8bd8d 1
```

а в каталоге 1 — с такой:
```
$ git log --one-line
5ea5e2c d
d42991a c
f980223 b
cff9df9 a
```

и хотим мы, чтобы коммиты a b c d из второго хранилища «приложились» к коммиту 2 из первого хранилища.

Во-первых, надо получить все коммиты в виде patch-файла:
```
$ cd /путь/к/хранилищу/1
$ git format-patch --stdout --root cff9df9 > patch
$ git format-patch --stdout cff9df9..HEAD >> patch
```

Две команды требуются для того, чтобы в файл patch попал и «корневой» коммит.

Во-вторых, применить их с помощью команды am в хранилище 0, предварительно создав там новую ветку, ответвлённую от коммита 2:
```
$ cd /путь/к/хранилищу/0
$ git checkout -b new 3e1fa25
$ git am /путь/к/хранилищу/1/patch
Applying: a
Applying: b
Applying: c
Applying: d
```

Если конфликтов не возникло, в хранилище 0 будет такая картина:
```
$ git log --oneline --all --decorate --graph
* 20b6b2f (HEAD -> new) d
* 8dedddf c
* 6ddec5e b
* cb7a798 a
  | * a3d5387 (master) 5
  | * 2b7f19f 4
  | * e1d8018 3
  |/
* 3e1fa25 2
* 7e8bd8d 1
```

Хэш-суммы, понятно, стали у «приложенных» коммитов другие, но всё остальное — содержимое, дата, автор — на месте.